# Wald（ウォルド）区間
- 推定値±誤差
  ```math
  p±z\sqrt{\frac{p(1-p)}{n}}
  ```
  - p: 標本比率（100サンプル中に80正解なら0.8）
  - z: 信頼係数に対応する値(95%なら1.96)
  - n: サンプルサイズ
  - ルート部分は標準偏差（ばらつき）を表す。
- Waldの問題点
  - waldの問題点はpのあたいによっては0~1の値に収まらないから。

# Wilson区間
### アプローチの根本的な違い

- Wald区間: 「推定値を中心に±誤差」を足し引き
- Wilson区間: 「観測データと矛盾しない母比率pの範囲」を方程式として解く

Wilson区間は「標本比率\(\hat{p}\)が観測された時、どの母比率pなら妥当か」を逆算します。 [slideshare](https://www.slideshare.net/slideshow/wilson-score-interval/73845508)

## Wilson区間の計算式
```math
\frac{\hat{p} + \frac{z^2}{2n}}{1 + \frac{z^2}{n}} \pm \frac{z}{1 + \frac{z^2}{n}} \sqrt{\frac{\hat{p}(1-\hat{p})}{n} + \frac{z^2}{4n^2}}
```
- p: 標本比率
- z: 信頼係数（95%なら1.96）
- n: サンプルサイズ

### 式の特徴

1. 分母に\(1 + \frac{z^2}{n}\)が入る → 区間が自動的に調整される
2. \(\hat{p}\)に\(\frac{z^2}{2n}\)を加える → 極端な値（0や1）を中心方向に補正
3. 平方根の中に\(\frac{z^2}{4n^2}\)が追加 → 適切に控えめな幅を確保 [best-biostatistics](https://best-biostatistics.com/toukei-er/entry/wilson-score-method-in-r/)

この構造により、数学的に0〜1の範囲を自動的に保証します。 [ja.wikipedia](https://ja.wikipedia.org/wiki/%E3%82%A6%E3%82%A3%E3%83%AB%E3%82%BD%E3%83%B3%E3%81%AE%E4%BF%A1%E9%A0%BC%E5%8C%BA%E9%96%93)

## Wilson区間の優れた特性

### 1. 必ず0〜1の範囲内に収まる

計算式の構造上、下限は必ず0以上、上限は必ず1以下になります。 [best-biostatistics](https://best-biostatistics.com/toukei-er/entry/wilson-score-method-in-r/)

例: 100サンプル中97成功（\(\hat{p}\) = 0.97）
- Wald区間: [0.936, 1.004] ← 1を超える
- Wilson区間: [0.915, 0.990] ← 適切な範囲 [best-biostatistics](https://best-biostatistics.com/toukei-er/entry/wilson-score-method-in-r/)

例: 100サンプル中3成功（\(\hat{p}\) = 0.03）
- Wald区間: [-0.003, 0.063] ← マイナスになる
- Wilson区間: [0.010, 0.085] ← 適切な範囲 [best-biostatistics](https://best-biostatistics.com/toukei-er/entry/wilson-score-method-in-r/)

### 2. 被覆率が安定して95%を維持

シミュレーション検証の結果、Wilson区間はどの条件でも安定して約95%の被覆率を達成します。 [qiita](https://qiita.com/shinya_2024/items/c6c9cec60c92e6d66b93)

特に以下の条件でWaldより明確に優れています:
- サンプルサイズが小さい（n < 30）
- 比率が極端（p < 0.1 or p > 0.9）
- 両方が重なる場合

### 3. 極端なケースでも適切な幅を保つ

10サンプル中10成功の場合:
- Wald区間: [1.0, 1.0]（幅ゼロ → 不合理）
- Wilson区間: [0.69, 1.0]（「完璧とは限らない」という現実的な不確かさを表現） [qiita](https://qiita.com/shinya_2024/items/c6c9cec60c92e6d66b93)

Wilson区間は「まだサンプルが少ないから、真の性能はこのくらいの幅がありそう」と適切に控えめな推定を示します。 [qiita](https://qiita.com/shinya_2024/items/c6c9cec60c92e6d66b93)

### 4. 計算が比較的容易

Clopper-Pearson法（exact method）のような厳密な方法と比べて:
- 複雑な累積分布関数が不要
- 四則演算と平方根だけで計算可能
- SQLなどでも実装可能 [slideshare](https://www.slideshare.net/slideshow/wilson-score-interval/73845508)

精度はexact methodに匹敵しながら、計算コストは低いです。 [blog.goo.ne](https://blog.goo.ne.jp/nakano-tomofumi/e/4920da87edbdfc0f5bd2fe8651aed1fa)

## 数値例での比較

### 例1: 10サンプル中9成功

| 方法 | 信頼区間 | 幅 |
|------|---------|-----|
| Wald | [0.71, 1.09] | 0.38（範囲外） |
| Wilson | [0.56, 0.99] | 0.43（適切） |

Wilsonは「サンプルが少ないので不確かさが大きい」ことを適切に反映しています。 [qiita](https://qiita.com/shinya_2024/items/c6c9cec60c92e6d66b93)

### 例2: 100サンプル中50成功

| 方法 | 信頼区間 | 幅 |
|------|---------|-----|
| Wald | [0.40, 0.60] | 0.20 |
| Wilson | [0.40, 0.60] | 0.20 |

サンプルサイズが十分大きく、pが0.5付近の場合は、WaldとWilsonはほぼ同じ結果になります。

### 例3: 1000サンプル中950成功

| 方法 | 信頼区間 |
|------|---------|
| Wald | [0.936, 0.964] |
| Wilson | [0.936, 0.964] |

大標本では両者の差はほとんどなくなります。

## Wilson区間の直感的理解

### 「Plus-4法」としての近似理解

Wilson区間は次のように近似的に理解できます: [statisticshowto](https://www.statisticshowto.com/wilson-ci/)

「成功2回、失敗2回を仮想的に追加してからWald法を適用する」

これにより:
- 極端な比率（0や1）が自動的に中心に引き寄せられる
- サンプルが少ない場合の不確かさが適切に反映される

### スコア検定との関係

Wilson区間はスコア検定（score test）に基づいており、カイ二乗検定と数学的に同等です。これが理論的な正確性の裏付けになっています。 [ja.wikipedia](https://ja.wikipedia.org/wiki/%E3%82%A6%E3%82%A3%E3%83%AB%E3%82%BD%E3%83%B3%E3%81%AE%E4%BF%A1%E9%A0%BC%E5%8C%BA%E9%96%93)

## まとめ: Wilson区間の優位性

1. 必ず0〜1の範囲内に収まる（数学的保証）
2. 被覆率が安定して約95%を維持
3. 小サンプルや極端な比率でも破綻しない
4. 適切に控えめな幅を提供（過信を防ぐ）
5. 計算が比較的容易（四則演算と平方根のみ）

実務での推奨: LLM評価では、サンプルサイズや比率にかかわらず、常にWilson区間をデフォルトで使用すべきです。